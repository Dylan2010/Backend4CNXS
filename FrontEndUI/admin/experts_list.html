<!doctype html>
<html><!-- InstanceBegin template="/Templates/manageTemplate.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta charset="utf-8">
<!-- InstanceBeginEditable name="doctitle" -->
<title>数舟管理</title>
<!-- InstanceEndEditable -->
<script type="text/javascript" src="../script/plugins/jquery-1.8.3.min.js"></script>
<!-- InstanceBeginEditable name="head" -->
<script>
$(document).ready(function(e) {
	console.log($.cookie('Token'))
	var expertData;
    function getData(doSetData){
		jQuery.support.cors = true;//跨域
		$.ajax({
			async: false,
			url : 'http://101.37.39.51:8080/api/Articles/v1/Type/Experts/list?limit=50',
			type: 'get',
			dataType : 'json',
			success : function(data){
				console.log(data);
				doSetData(data);
			},
			error: function(e){
				var a=JSON.stringify(e);
				////alert(a);
			}
		});
		
	}
	function setData(data){
		expertData = data;
		$.each(expertData,function(n,v){
			var li = $(document.createElement("li"));
			var title = $(document.createElement("h3"));
			title.text(v.title);
			var summary = $(document.createElement("p"));
			summary.text(v.summary);
			var content = $(document.createElement("p"));
			content = v.content;
			
			var btns = $(document.createElement("div"));
			var editBtn = $(document.createElement("input"));
			editBtn.attr("type","button");
			editBtn.val("编辑");
			editBtn.click(function(){
				window.location.href="./experts_modify.html?id="+v.id;
			});
			var deleteBtn = $(document.createElement("input"));
			deleteBtn.attr("type","button");
			deleteBtn.val("删除");
			deleteBtn.click(function(){
				if(confirm("确定删除吗?（此操作不可恢复）")){
					  deleteData(v.id);
				  }else{
					  return false;
				  }
			});
			
			btns.append(editBtn);
			btns.append(deleteBtn);
			li.append(title);
			li.append(summary);
			li.append(content);
			li.append(btns);
			$("#list").append(li);
			
		});
	}
	getData(setData);
	function deleteData(id){
		jQuery.support.cors = true;
		$.ajax({
			contentType : "application/json; charset=utf-8",
			url : "http://101.37.39.51:8080/api/Articles/v1/Type/Experts/id/"+id,
			type : "DELETE",
			success : function(){
				alert("删除成功！");
				$("#list").empty();
				getData(setData);
			},
			error : function(e){
				console.log(e);
			}
		});
	}
	
	$("#addBtn").click(function(){
		window.open('./experts_add.html');
	});
	
});
</script>
<!-- InstanceEndEditable -->
</head>

<body>
<ul>
	<li>
    	<a href="events_list.html">企业动态</a>
    </li>
    <li>
    	<a href="experts_list.html">专家专栏</a>
    </li>
    <li>
    	<a href="infos_list.html">行业资讯</a>
    </li>
</ul>
<!-- InstanceBeginEditable name="mainContent" -->
<div>
	<h1>专家专栏</h1>
	<input type="button" id="addBtn" value="新增"/>
	<ul id="list">
    </ul>
</div>
<!-- InstanceEndEditable -->
</body>
<!-- InstanceEnd --></html>
